# 二进制安装mysql

**环境准备：**

服务器环境：Rocky9.x

### 下载安装包

1. 官网下载mysql，二进制安装包，下载地址：`https://www.mysql.com/`。

   ![](/img/image-20260109103307277.png)

1. 选择社区版下载。

   ![image-20260109103322692](/img/image-20260109103322692.png)

2. 选择服务端版本。

   ![image-20260109103754873](/img/image-20260109103754873.png)

3. 查看服务器的glibc版本`dnf info glibc`,版本`Version:2.34`。

   ```shell
   [root@localhost ~]# dnf info glibc
   Last metadata expiration check: 2:23:11 ago on Fri 09 Jan 2026 01:03:28 PM CST.
   Installed Packages
   Name         : glibc
   Version      : 2.34
   Release      : 168.el9_6.14
   Architecture : x86_64
   Size         : 6.1 M
   Source       : glibc-2.34-168.el9_6.14.src.rpm
   Repository   : @System
   From repo    : minimal
   Summary      : The GNU libc libraries
   URL          : http://www.gnu.org/software/glibc/
   License      : LGPLv2+ and LGPLv2+ with exceptions and GPLv2+ and GPLv2+ with exceptions and BSD and Inner-Net and ISC and Public Domain and GFDL
   Description  : The glibc package contains standard libraries which are used by
                : multiple programs on the system. In order to save disk space and
                : memory, as well as to make upgrading easier, common system code is
                : kept in one place and shared between programs. This particular package
                : contains the most important sets of shared libraries: the standard C
                : library and the standard math library. Without these two libraries, a
                : Linux system will not function.
   
   Available Packages
   Name         : glibc
   Version      : 2.34
   Release      : 231.el9_7.2
   Architecture : x86_64
   Size         : 2.0 M
   Source       : glibc-2.34-231.el9_7.2.src.rpm
   Repository   : baseos
   Summary      : The GNU libc libraries
   URL          : http://www.gnu.org/software/glibc/
   License      : LGPLv2+ and LGPLv2+ with exceptions and GPLv2+ and GPLv2+ with exceptions and BSD and Inner-Net and ISC and Public Domain and GFDL
   Description  : The glibc package contains standard libraries which are used by
                : multiple programs on the system. In order to save disk space and
                : memory, as well as to make upgrading easier, common system code is
                : kept in one place and shared between programs. This particular package
                : contains the most important sets of shared libraries: the standard C
                : library and the standard math library. Without these two libraries, a
                : Linux system will not function.
   
   Name         : glibc
   Version      : 2.34
   Release      : 231.el9_7.2
   Architecture : i686
   Size         : 1.9 M
   Source       : glibc-2.34-231.el9_7.2.src.rpm
   Repository   : baseos
   Summary      : The GNU libc libraries
   URL          : http://www.gnu.org/software/glibc/
   License      : LGPLv2+ and LGPLv2+ with exceptions and GPLv2+ and GPLv2+ with exceptions and BSD and Inner-Net and ISC and Public Domain and GFDL
   Description  : The glibc package contains standard libraries which are used by
                : multiple programs on the system. In order to save disk space and
                : memory, as well as to make upgrading easier, common system code is
                : kept in one place and shared between programs. This particular package
                : contains the most important sets of shared libraries: the standard C
                : library and the standard math library. Without these two libraries, a
                : Linux system will not function.
   ```

4. 根据自身系统的glibc版本下载对应的mysql二进制包安装,大于2.28的直接下载2.28版本。

   ![](/img/image-20260109110517591.png)

### 配置mysql

1. 解压mysql二进制文件。

   ```
   mkdir -p /usr/local/mysql && tar -xvf mysql-8.0.44-linux-glibc2.28-x86_64.tar.xz  -C /usr/local/mysql --strip-components=1
   echo 'PATH=/usr/local/mysql/bin/:$PATH' >> /etc/profile
   source /etc/profile
   ```

2. 准备配置文件my.cnf。

   ```
   cat > /etc/my.cnf <<-EOF
   [mysqld]
   # --- 基础设置 ---
   user                            = mysql
   port                            = 3306
   character-set-server            = utf8mb4
   collation-server                = utf8mb4_unicode_ci
   datadir                         =/data/mysql
   socket                          =/data/mysql/mysql.sock
   log-error                       =/var/log/mysql/mysql.log
   pid-file                        =/var/log/mysql/mysqld.pid
   
   # --- 连接与安全 ---
   max_connections                 = 500         # 最大连接数，根据业务调整
   max_allowed_packet              = 64M
   interactive_timeout             = 3600
   wait_timeout                    = 3600
   
   # --- 核心内存优化 (InnoDB) ---
   # 核心：设置为系统总内存的 50%-75%
   innodb_buffer_pool_size         = 1G          
   innodb_buffer_pool_instances    = 8           # 减少缓冲池竞争
   innodb_flush_log_at_trx_commit  = 1           # 1最安全，2性能更高（但在宕机时可能丢失1秒数据）
   innodb_log_file_size            = 200M          # 重做日志大小
   innodb_log_buffer_size          = 16M
   innodb_file_per_table           = 1
   innodb_io_capacity              = 1000        # 如果是SSD，可以设为2000+
   
   # --- 临时表与缓存 ---
   tmp_table_size                  = 64M
   max_heap_table_size             = 64M
   join_buffer_size                = 4M
   sort_buffer_size                = 4M
   read_buffer_size                = 2M
   read_rnd_buffer_size            = 8M
   
   # --- 二进制日志 (Binlog) ---
   log_bin                         = mysql-bin
   binlog_format                   = ROW
   expire_logs_days                = 14           # 自动清理7天前的日志
   binlog_expire_logs_seconds      = 604800      # MySQL 8.0 推荐写法
   
   # --- 性能 Schema ---
   performance_schema              = ON
   
   [client]
   socket                          =/data/mysql/mysql.sock
   EOF
   ```

3. 创建mysql数据目录，并添加mysql用户。

   ```
   useradd mysql
   mkdir -p /var/log/mysql
   chown -R mysql:mysql /var/log/mysql
   ```
   
4. 初始化数据库目录。

   ```
   /usr/local/mysql/bin/mysqld \
     --initialize \
     --user=mysql \
     --datadir=/data/mysql
   ```

5. 添加mysql服务。

   ```
   cat > /lib/systemd/system/mysqld.service <<-EOF
   [Unit]
   Description=MySQL Community Server
   After=network.target
   
   [Service]
   User=mysql
   Group=mysql
   Type=simple
   RuntimeDirectory=mysqld
   RuntimeDirectoryMode=0755
   ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf 
   LimitNOFILE=65535
   Restart=on-failure
   RestartSec=10
   
   [Install]
   WantedBy=multi-user.target
   EOF
   
   systemctl daemon-reload && systemctl enable --now mysqld
   ```
6. 查看mysql初始化密码。
   ```
   [root@localhost mysql]# cat /var/log/mysql/mysql.log |grep password
   2026-01-10T10:05:46.920092Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: -vs!kgemF2Ex
   ```

7. 修改mysql密码。

   ```
   [root@localhost mysql]# mysql -uroot -p
   Enter password:
   
   
   ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码xxx';
   FLUSH PRIVILEGES;
   ```
